## Socket测试使用说明文档

​		本文档主要介绍WiFi专项测试程序的Socket网络测试部分，包括HTTP、HTTPS、TCP Socket和UDP Socket四种测试功能的使用说明。

### 从主界面跳转到Socket测试

在主界面选择"APP"标签页，可以看到四种Socket测试选项：
- HTTP验证
- HTTPS验证
- TCP Socket验证
- UDP Socket验证

点击相应选项进入对应的测试页面。

---

## 一、HTTP测试

### 功能说明

HTTP测试模块用于验证设备的HTTP网络请求功能，支持多种HTTP请求方法。

### 主要接口（@ohos.net.http）

|        功能名称        |          API名称          |              所需参数              |        返回值        | 备注                 |
| :--------------------: | :-----------------------: | :--------------------------------: | :------------------: | :------------------- |
|      创建HTTP请求      |      createHttp()         |                ()                  |        HttpRequest   | 创建HTTP请求对象     |
|      发送HTTP请求      |   httpRequest.request     | (url, options, callback)           | HttpResponse         | 发送请求并获取响应   |
|    订阅响应头事件      | httpRequest.on('headersReceive') |       (callback)            | void                 | 监听响应头           |
|    取消订阅响应头      | httpRequest.off('headersReceive') |       ()                   | void                 | 取消监听             |
|      销毁请求对象      |   httpRequest.destroy     |                ()                  | void                 | 释放资源             |

### 请求配置

#### HTTP请求方法

支持以下HTTP请求方法：
- **GET**：获取资源（默认URL：http://www.baidu.com）
- **POST**：提交数据（默认URL：https://httpbin.org/post）
- **PUT**：更新资源
- **DELETE**：删除资源
- **TRACE**：回显服务器收到的请求
- **CONNECT**：建立隧道连接
- **OPTIONS**：查询支持的方法

#### 请求体配置

|   类型    | 说明                                  |
| :-------: | :------------------------------------ |
|   none    | 不发送请求体（适用于GET等方法）       |
|    raw    | 发送原始JSON数据（适用于POST等方法）  |

#### 配置参数

|      参数名称      |       类型       |   默认值    | 说明                           |
| :----------------: | :--------------: | :---------: | :----------------------------- |
|    请求方法        |   RequestMethod  |     GET     | HTTP请求方法                   |
|    请求URL         |      string      | http://www.baidu.com | 目标URL地址      |
|    请求体类型      |      string      |    none     | 请求体数据类型                 |
|    请求体内容      |      string      |     空      | 请求体数据（POST时可用）       |
|    连接超时        |      number      |   60000     | 连接超时时间（毫秒）           |
|    读取超时        |      number      |   60000     | 读取超时时间（毫秒）           |

### 响应信息

#### HttpResponse对象

|     字段名     |    类型    | 说明                          |
| :------------: | :--------: | :---------------------------- |
|     result     |   Object   | 响应内容                      |
|  responseCode  |   number   | HTTP状态码（200、404等）      |
|   resultType   |   number   | 响应数据类型                  |
|     header     |   Object   | 响应头信息                    |
|    cookies     |   string   | Cookie信息                    |

### 测试步骤

1. **选择请求方法**
   - 点击下拉框选择HTTP方法（GET、POST等）
   - 系统会自动设置对应的默认URL

2. **配置请求URL**
   - 在URL输入框中输入目标地址
   - 支持http://开头的地址

3. **配置请求体**（可选）
   - 选择请求体类型（none或raw）
   - 如果选择raw，在输入框中输入JSON数据
   - 示例：`{"username": "test","password": "123"}`

4. **发送请求**
   - 点击"发送请求"按钮
   - 等待响应（按钮会变灰显示"加载中"）

5. **查看响应**
   - 响应状态区域显示HTTP状态码
     - 2xx：成功（绿色）
     - 其他：失败（红色）
   - 响应数据区域显示完整的响应信息

6. **清空响应**
   - 点击"清空响应"按钮清除响应数据

### 注意事项

1. **网络权限**：应用需要配置网络访问权限
2. **跨域问题**：某些网站可能限制访问
3. **超时设置**：根据网络情况调整超时时间
4. **资源释放**：请求完成后会自动销毁请求对象

---

## 二、HTTPS测试

### 功能说明

HTTPS测试模块用于验证设备的HTTPS安全网络请求功能，在HTTP的基础上增加了SSL/TLS加密传输和证书验证功能。

### 主要接口（@ohos.net.http）

与HTTP测试使用相同的API，但增加了HTTPS特定配置选项。

### 请求配置

#### HTTPS特定配置

|      参数名称      |       类型       |   默认值    | 说明                           |
| :----------------: | :--------------: | :---------: | :----------------------------- |
|    请求方法        |   RequestMethod  |     GET     | HTTP请求方法                   |
|    请求URL         |      string      | https://www.baidu.com | 目标HTTPS地址   |
|   SSL证书验证      |     boolean      |    true     | 是否验证SSL证书                |
|    使用缓存        |     boolean      |    true     | 是否使用缓存                   |
|      优先级        |      number      |      1      | 请求优先级                     |
|   使用协议版本     |   HttpProtocol   |   HTTP2     | HTTP协议版本                   |
|    请求体类型      |      string      |    none     | 请求体数据类型                 |
|    请求体内容      |      string      |     空      | 请求体数据                     |
|    连接超时        |      number      |   60000     | 连接超时时间（毫秒）           |
|    读取超时        |      number      |   60000     | 读取超时时间（毫秒）           |

#### SSL证书验证开关

- **开启（默认）**：验证服务器SSL证书，确保连接安全
- **关闭**：跳过证书验证，用于测试自签名证书的服务器

### 响应信息

HTTPS响应信息与HTTP相同，但会包含SSL连接相关信息。

### 测试步骤

1. **选择请求方法**
   - 点击下拉框选择HTTP方法
   - 系统会自动设置对应的默认HTTPS URL

2. **配置请求URL**
   - 在URL输入框中输入目标地址
   - 必须以https://开头

3. **配置SSL验证**
   - 切换SSL证书验证开关
   - 开启：显示"开启"（绿色）
   - 关闭：显示"关闭"（红色）

4. **配置请求体**（可选）
   - 与HTTP测试相同

5. **发送HTTPS请求**
   - 点击"发送HTTPS请求"按钮
   - 等待响应

6. **查看响应**
   - 查看响应状态码和数据
   - 成功连接会显示"SSL连接成功"
   - SSL错误会显示相应提示

7. **清空响应**
   - 点击"清空响应"按钮

### 注意事项

1. **证书问题**
   - 如果遇到证书错误，可以尝试关闭SSL验证（仅用于测试）
   - 生产环境应始终开启SSL验证

2. **协议支持**
   - 优先使用HTTP/2协议
   - 服务器不支持时会自动降级

3. **性能考虑**
   - HTTPS比HTTP性能开销更大
   - 可能需要更长的连接时间

---

## 三、TCP Socket测试

### 功能说明

TCP Socket测试模块用于验证设备的TCP网络通信功能，支持面向连接的可靠数据传输。

### 主要接口（@ohos.net.socket）

|        功能名称        |          API名称          |              所需参数              |        返回值        | 备注                 |
| :--------------------: | :-----------------------: | :--------------------------------: | :------------------: | :------------------- |
|   创建TCP Socket对象   | constructTCPSocketInstance|                ()                  |      TCPSocket       | 创建TCP Socket       |
|      绑定本地地址      |    tcpSocket.bind         |         (NetAddress)               |      Promise<void>   | 绑定本地端口         |
|      连接到服务器      |   tcpSocket.connect       |     (TCPConnectOptions)            |      Promise<void>   | 建立TCP连接          |
|        发送数据        |     tcpSocket.send        |      (TCPSendOptions)              |      Promise<void>   | 发送数据             |
|      关闭连接          |    tcpSocket.close        |                ()                  |      Promise<void>   | 关闭TCP连接          |
|    监听消息接收        |  tcpSocket.on('message')  |           (callback)               |         void         | 接收数据回调         |
|    监听连接关闭        |   tcpSocket.on('close')   |           (callback)               |         void         | 连接关闭回调         |
|    监听错误事件        |   tcpSocket.on('error')   |           (callback)               |         void         | 错误事件回调         |
|    取消消息监听        | tcpSocket.off('message')  |           (callback?)              |         void         | 取消接收监听         |
|    取消关闭监听        |  tcpSocket.off('close')   |           (callback?)              |         void         | 取消关闭监听         |
|    取消错误监听        |  tcpSocket.off('error')   |           (callback?)              |         void         | 取消错误监听         |

### 配置参数

#### NetAddress对象

|   字段名    |  类型  | 说明                           |
| :---------: | :----: | :----------------------------- |
|   address   | string | IP地址                         |
|     port    | number | 端口号                         |
|    family   | number | 地址族（1=IPv4，2=IPv6）       |

#### 测试配置

|      参数名称      |       类型       |      默认值      | 说明                           |
| :----------------: | :--------------: | :--------------: | :----------------------------- |
|    服务器地址      |      string      |  192.168.1.100   | TCP服务器IP地址                |
|    服务器端口      |      number      |      8080        | TCP服务器端口号                |
|    发送消息        |      string      | Hello TCP Server | 要发送的测试消息               |

### 连接状态

|    状态值    | 说明         | 颜色   |
| :----------: | :----------- | :----- |
|    未连接    | 初始状态     | 红色   |
|    连接中    | 正在连接     | 橙色   |
|    已连接    | 连接成功     | 绿色   |
|   连接错误   | 连接失败     | 红色   |
|  连接已关闭  | 连接已断开   | 红色   |
|    已断开    | 主动断开     | 红色   |

### 测试步骤

1. **配置服务器信息**
   - 输入TCP服务器的IP地址
   - 输入TCP服务器的端口号
   - 默认值：192.168.1.100:8080

2. **连接到服务器**
   - 点击"连接"按钮
   - 等待连接建立
   - 连接状态显示"已连接"（绿色）
   - 自动设置消息、错误、关闭事件的监听回调

3. **发送消息**
   - 在"发送消息"输入框中输入要发送的内容
   - 点击"发送"按钮
   - 响应数据区域显示"发送: xxx"

4. **接收消息**
   - 当服务器返回数据时
   - 响应数据区域自动显示"收到: xxx"

5. **断开连接**
   - 点击"断开"按钮
   - 连接状态变为"已断开"
   - 响应数据区域显示"主动断开连接"

6. **清空响应**
   - 点击"清空"按钮清除响应数据

### 事件回调说明

#### message事件
- 当接收到服务器数据时触发
- 回调参数包含接收到的数据

#### error事件
- 当发生Socket错误时触发
- 回调参数包含错误信息
- 连接状态变为"连接错误"

#### close事件
- 当连接关闭时触发
- 可能是服务器主动关闭或网络异常
- 连接状态变为"连接已关闭"

### 注意事项

1. **服务器要求**
   - 需要有可访问的TCP服务器
   - 服务器必须支持TCP连接
   - 确保服务器地址和端口正确

2. **连接顺序**
   - 必须先连接才能发送数据
   - 连接成功后"发送"按钮才可用

3. **资源释放**
   - 页面退出时会自动关闭连接
   - 建议测试完成后主动断开连接

4. **网络环境**
   - 确保设备与服务器在同一网络或可互相访问
   - 检查防火墙设置

---

## 四、UDP Socket测试

### 功能说明

UDP Socket测试模块用于验证设备的UDP网络通信功能，支持无连接的数据报传输。

### 主要接口（@ohos.net.socket）

|        功能名称        |          API名称          |              所需参数              |        返回值        | 备注                 |
| :--------------------: | :-----------------------: | :--------------------------------: | :------------------: | :------------------- |
|   创建UDP Socket对象   | constructUDPSocketInstance|                ()                  |      UDPSocket       | 创建UDP Socket       |
|      绑定本地端口      |    udpSocket.bind         |         (NetAddress)               |      Promise<void>   | 绑定本地端口监听     |
|        发送数据        |     udpSocket.send        |      (UDPSendOptions)              |      Promise<void>   | 发送数据到指定地址   |
|      关闭Socket        |    udpSocket.close        |                ()                  |      Promise<void>   | 关闭UDP Socket       |
|    监听消息接收        |  udpSocket.on('message')  |           (callback)               |         void         | 接收数据回调         |
|    监听错误事件        |   udpSocket.on('error')   |           (callback)               |         void         | 错误事件回调         |
|    监听监听事件        | udpSocket.on('listening') |           (callback)               |         void         | 开始监听回调         |
|    监听关闭事件        |   udpSocket.on('close')   |           (callback)               |         void         | Socket关闭回调       |
|    取消消息监听        | udpSocket.off('message')  |           (callback?)              |         void         | 取消接收监听         |
|    取消错误监听        |  udpSocket.off('error')   |           (callback?)              |         void         | 取消错误监听         |
|    取消监听监听        | udpSocket.off('listening')|           (callback?)              |         void         | 取消监听监听         |
|    取消关闭监听        |  udpSocket.off('close')   |           (callback?)              |         void         | 取消关闭监听         |

### 配置参数

#### UDPSendOptions对象

|   字段名    |     类型     | 说明                           |
| :---------: | :----------: | :----------------------------- |
|    data     |    string    | 要发送的数据                   |
|   address   |  NetAddress  | 目标地址信息                   |

#### 测试配置

|      参数名称      |       类型       |      默认值      | 说明                           |
| :----------------: | :--------------: | :--------------: | :----------------------------- |
|    本地端口        |      number      |      9090        | 本地绑定的端口号               |
|    目标地址        |      string      |  192.168.1.100   | UDP目标服务器IP地址            |
|    目标端口        |      number      |      8081        | UDP目标服务器端口号            |
|    发送消息        |      string      | Hello UDP Server | 要发送的测试消息               |

### Socket状态

|    状态值    | 说明             | 颜色   |
| :----------: | :--------------- | :----- |
|    未绑定    | 初始状态         | 红色   |
|    绑定中    | 正在绑定端口     | 橙色   |
|    已绑定    | 绑定成功         | 绿色   |
|  Socket错误  | 发生错误         | 红色   |
| Socket已关闭 | Socket已关闭     | 红色   |
|    已关闭    | 主动关闭         | 红色   |

### 测试步骤

1. **配置本地端口**
   - 输入本地要绑定的端口号
   - 默认值：9090
   - 用于接收数据

2. **配置目标服务器**
   - 输入UDP服务器的IP地址
   - 输入UDP服务器的端口号
   - 默认值：192.168.1.100:8081

3. **绑定Socket**
   - 点击"绑定"按钮
   - 等待绑定完成
   - Socket状态显示"已绑定"（绿色）
   - 自动设置消息、错误、监听、关闭事件的回调

4. **发送消息**
   - 在"发送消息"输入框中输入要发送的内容
   - 点击"发送"按钮
   - 响应数据区域显示"发送到 IP:端口: xxx"

5. **接收消息**
   - 当接收到数据时
   - 响应数据区域自动显示"收到: xxx (来自: IP:端口)"

6. **关闭Socket**
   - 点击"关闭"按钮
   - Socket状态变为"已关闭"
   - 响应数据区域显示"主动关闭Socket"

7. **清空响应**
   - 点击"清空"按钮清除响应数据

### UDP vs TCP的区别

|     特性     |       TCP        |       UDP        |
| :----------: | :--------------: | :--------------: |
|   连接方式   | 面向连接         | 无连接           |
|   可靠性     | 可靠传输         | 不可靠传输       |
|   传输顺序   | 保证顺序         | 不保证顺序       |
|   速度       | 较慢             | 较快             |
|   开销       | 较大             | 较小             |
|   适用场景   | 文件传输、网页   | 视频流、游戏     |

### 事件回调说明

#### message事件
- 当接收到数据时触发
- 回调参数包含数据内容和发送方信息（IP、端口）

#### listening事件
- 当Socket开始监听时触发
- 表示绑定成功，可以接收数据

#### error事件
- 当发生Socket错误时触发
- 回调参数包含错误信息
- Socket状态变为"Socket错误"

#### close事件
- 当Socket关闭时触发
- Socket状态变为"Socket已关闭"

### 注意事项

1. **UDP特性**
   - UDP不保证数据送达
   - 数据可能丢失、重复或乱序
   - 不需要建立连接，直接发送

2. **端口绑定**
   - 必须先绑定本地端口才能发送数据
   - 绑定成功后"发送"按钮才可用
   - 确保端口未被其他程序占用

3. **广播和组播**
   - UDP支持广播和组播
   - 可以同时向多个目标发送数据

4. **资源释放**
   - 页面退出时会自动关闭Socket
   - 建议测试完成后主动关闭Socket

5. **网络环境**
   - 某些网络环境可能限制UDP通信
   - 检查防火墙和路由器设置

---

## 五、测试建议

### 测试顺序建议

1. **HTTP测试**
   - 先测试HTTP GET请求（最简单）
   - 再测试HTTP POST请求
   - 最后测试其他HTTP方法

2. **HTTPS测试**
   - 在HTTP测试成功后再测试HTTPS
   - 先测试开启SSL验证的情况
   - 遇到证书问题时再关闭SSL验证测试

3. **TCP Socket测试**
   - 确保有可用的TCP测试服务器
   - 先测试连接功能
   - 再测试数据收发功能

4. **UDP Socket测试**
   - 确保有可用的UDP测试服务器
   - 先测试绑定功能
   - 再测试数据收发功能

### 常见问题排查

1. **连接失败**
   - 检查网络连接
   - 确认服务器地址和端口正确
   - 检查防火墙设置

2. **无响应**
   - 检查超时设置
   - 确认服务器正常运行
   - 查看错误日志

3. **证书错误（HTTPS）**
   - 确认服务器证书有效
   - 尝试关闭SSL验证（仅测试用）
   - 检查设备时间是否正确

4. **端口被占用（Socket）**
   - 更换其他端口号
   - 关闭占用端口的程序
   - 重启设备

### 性能测试建议

1. **HTTP/HTTPS**
   - 测试不同大小的数据传输
   - 测试并发请求
   - 测试长时间连接

2. **TCP Socket**
   - 测试大数据量传输
   - 测试连接稳定性
   - 测试异常断开重连

3. **UDP Socket**
   - 测试数据丢包率
   - 测试高频发送
   - 测试数据包大小限制

---

*最后更新：2025年10月*

